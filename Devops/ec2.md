# EC2

![스크린샷 2022-04-08 오후 4.20.39.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.20.39.png)

EC2 특징

- 사용한 만큼 요금 지불, 초당으로 계산
    - 잘못사용하면 엄청난 비용 발생
- 전 세계 어디든지 빠르게 인스턴스를 생성하고 서비스 운영 가능
- 다양한 AWS 서비스 연동 가능

EC2와 주요 구성요소 cpu, 램, ebs, eni들은 AZ 기반 ⇒ 하나의 데이터센터안에 있다.

**Multi AZ** → 둘 이상의 AZ를 활용해서 서비스를 구축 / 두 대 이상의 서버가 필요 / 주로 ELB를 이용해서 서버를 연결해서 사용

### 구성 요소

![스크린샷 2022-04-08 오후 4.25.36.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.25.36.png)

VPC는 서브넷으로 쪼개지고 이런 서브넷은 EC2가 연결해서 사용

![스크린샷 2022-04-08 오후 4.27.46.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.27.46.png)

예시

Application Load Balancer는 ELB

![스크린샷 2022-04-08 오후 4.29.35.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.29.35.png)

인스턴스 유형 ⇒ 꼭 훑어보기

[Amazon EC2 인스턴스 유형 - Amazon Web Services](https://aws.amazon.com/ko/ec2/instance-types/)

## 실습

EC2 - 인스턴스 생성 / 적절한 인스턴스 선택 / 

스팟 인스턴스 → 경매 방식으로 인스턴스 구매

서브넷 → AZ 수만큼 존재

퍼블릭 IP → ssh로 접속하기 위해서 필요

![스크린샷 2022-04-08 오후 4.39.53.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.39.53.png)

메타데이터는 일종의 스크립트로 EC2가 처음 생성될 때 1번 실행

![스크린샷 2022-04-08 오후 4.42.06.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.42.06.png)

인스턴스에 태그 추가) 추천 Name은 반드시 할 것

![스크린샷 2022-04-08 오후 4.43.32.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.43.32.png)

보안 그룹 구성

![스크린샷 2022-04-08 오후 4.44.51.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.44.51.png)

실행하기

EC2 - 인스턴스 접속 & 접속할 인스턴스 클릭 - 연결 버튼 클릭 - 

원하는 연결 방식 클릭

EC2 인스턴스 연결은 인터넷으로 빠르게 연결

![스크린샷 2022-04-08 오후 4.48.44.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.48.44.png)

+) 사용안할 거면 반드시 중지 후 종료 (중지해도 비용 발생)

![스크린샷 2022-04-08 오후 4.50.10.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.50.10.png)

ssh 이용해서 접속하기

```bash
ssh -i 나의보안.pem ec2-user@퍼블릭IP
//사전에 pem chmod를 변형해줘야함
```

-rw-r—r— : 나는 읽기 쓰기 가능 / 내가 속한 그룹의 권한 / 이외 그룹 권한

-r———— : 나만 읽기 가능으로 변경

chmod 400 파일.Pem

![스크린샷 2022-04-08 오후 4.56.59.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.56.59.png)

**인스턴스를 중지 후 재시작하면 IP가 변경 → 고정 IP가 필요하면 Elastic IP를 사용하자**

EC2 / 탄력적 IP / 탄력적 IP 주소 할당 & 생성 / 이름 변경 / 작업 - 탄력적 IP 주소 변경 / 적용

![스크린샷 2022-04-08 오후 5.00.12.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.00.12.png)

![스크린샷 2022-04-08 오후 5.02.21.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.02.21.png)

### EBS 스냅샷 생성 실습

- EBS 스냅샷 : 가장 간단한 EBS 데이터의 백업 방법
- 리전 서비스
- 스냅샷은 안전하게 S3에 저장됨
- 증분으로 관리되므로 용량 및 비용 효율적 (변경한 내용만 추가된다.)
- 실행 중인 인스턴스에서도 생성 가능하지만 가급적 정지 후에 생성하는 것이 좋다
- EBS는 AZ 서비스지만 스냅샷을 이용해서 다른 AZ로 복사 가능

인스턴스 / Elastic Block Store / 스냅샷 / 스냅샷 생성

![스크린샷 2022-04-15 오후 4.43.12.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.43.12.png)

이후 

스냅샷 리스트에서 스냅샷 선택 / 스냅샷에서 볼륨 생성 / 스냅샷 생성

을 통해서 가용 영역을 변경할 수 도 있다.

### AMI 생성하기

- EC2의 백업 이미지임
- EBS 스냅샷 + 메타데이터로 구성이 됨
- AMI를 이용해서 EC2를 다른 AZ로 옮길 수 있음

인스턴스 서비스에서 아래와 같이 클릭

![스크린샷 2022-04-15 오후 4.53.59.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.53.59.png)

이미지 / AMI에서 확인가능

추가로 스냅샷 탭에 들어가면 AMI에 따른 스냅샷이 생성된다. → AMI를 삭제하고 스냅샷을 삭제해야한다.

AMI를 선택하고 인스턴스 시작을 누르면 인스턴스 생성과정과 똑같이 하면된다.

![스크린샷 2022-04-15 오후 4.56.40.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.56.40.png)

### EC2 메타데이터

![스크린샷 2022-04-15 오후 5.00.18.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.00.18.png)

curl -w '\n' [http://169.254.169.254/latest/meta-data](http://169.254.169.254/latest/meta-data)

다양한 정보를 얻을 수 있다.

![스크린샷 2022-04-15 오후 5.04.57.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.04.57.png)

### EC2 Role 사용해보기

IAM-ROLE처럼 인스턴스가 다른 AWS 리소스를 제어할 때 사용

Ex) 인스턴스가 S3를 접근할 때

![스크린샷 2022-04-15 오후 5.20.40.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.20.40.png)

EC2 / 인스턴스 / 특정 인스턴스 선택 / IAM 역할 수정 들어가기

![스크린샷 2022-04-15 오후 5.33.30.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.33.30.png)

위 명령을 통해 ec2에서 s3 접근이 가능해짐

![스크린샷 2022-04-15 오후 5.36.15.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.36.15.png)

그러나 내가 만든 개발권한은 EC2에 연결하는 권한이 없음

EC2 인스턴스에서 aws를 사용하려면 IAM을 등록해줘야하는데 현재 내가 지정한 개발 권한에서는 IAM 설정이 불가능(어드민 권한은 가능) 그래서 먼저 개발 권한을 변경

지난번에 만든 개발권한에서 iam 사용 역할 전환을 통해 아래와 같이 생성

![스크린샷 2022-04-15 오후 5.38.15.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.38.15.png)

그래서 커스텀 롤 policy를 만든다.

 

![스크린샷 2022-04-15 오후 5.38.50.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.38.50.png)

추가를 해준다.

![스크린샷 2022-04-15 오후 5.40.28.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.40.28.png)

위 방법이 베스트 프렉티스 & 자주 사용되므로 숙지하면 좋음

### 팁

![스크린샷 2022-04-15 오후 5.41.56.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.41.56.png)

![스크린샷 2022-04-15 오후 5.43.11.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.43.11.png)

![스크린샷 2022-04-15 오후 5.44.02.png](EC2%20a7e5f80c29f04917b5bccb906c160687/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.44.02.png)