# S3

## S3 Amazon Simple Storage Service

- 객체 스토리지
- 파일 업로드, 다운로드, 검색 가능
- 무제한 용량
- 다양한 인증 / 권한 부여 제공
- 객체 = 파일
- 객체를 담는 “버킷”
- 1기가 파일에서 1글자만 수정해도 1기가가 다시 업로드 된다. → 최소 단위가 객체
- key : 버킷안의 오브젝트를 식별하는데 사용
- version
- prefix

### 특징

- 리전 기반 서비스(가용영역 2개 이상) → 매우 안전하다. (99.999999999% 내구도)
- 상대적으로 빠르지는 않다.
- CND(AWS CloudFront와 연동 가능)
- static web page 기능 지원
- 필요에 따라 버저닝(versioning) 기능 사용 가능
- 다양한 요금 옵션으로 비용 절감 가능

### 사용예

- 클라우드 저장소
- 서비스의 대용령 파일 저장소
- 서비스 로그 저장 및 분석 ⇒ EC2에 저장하지 말 것! / CloudWatch Logs라는 서비스를 사용할 수 도 있음
- AWS 아데나(빅데이터 분석 서비스)를 이용한 빅데이터 업로드 및 분석
- 서비스 사용자의 데이터 업로드 서버
- **중요한 파일은 EC2보다는 S3에 저장하자**
- glacier(자주 사용하지 않는 데이터)와의 연동으로 비용 절감 및 규정 준수 가능

### 실습

스토리지 / S3로 이동 / 버킷 만들기 클릭

**버킷 이름은 반드시 유니크해야한다**.

![스크린샷 2022-04-08 오후 2.52.33.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.52.33.png)

이후 생성된 버킷에서 업로드 버튼을 통해 쉽게 올릴 수 있다.

![스크린샷 2022-04-08 오후 2.56.58.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.56.58.png)

실제로 올린 파일의 정보를 보면 url이 존재하는데 이를 통해 해당 파일로 접근할 수 도 있다.

![스크린샷 2022-04-08 오후 2.58.34.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.58.34.png)

또한 폴더 만들기 버튼도 있는데 이는 실제로 폴더를 생성 하는 것이 아닌 prefix를 지정해서 저장하는 것이다.

이외에도 파일 옮기기 / 복사 등의 기능이 있다.

버킷을 삭제하려면 버킷 내부에 있는 파일들을 삭제해야한다.

![스크린샷 2022-04-08 오후 3.01.45.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.01.45.png)

그러나 일일이 삭제하기에는 번거롭다.

물론 CLI를 통해 쉽게 삭제할 수 있지만 GUI를 통해서는 “비어 있음" 버튼을 통해 쉽게 삭제할 수 있다.

![스크린샷 2022-04-08 오후 3.02.54.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.02.54.png)

## S3 권한 제어

![스크린샷 2022-04-08 오후 3.09.15.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.09.15.png)

presignedURL은 개발에서 많이 사용

### public 접근 설정

일반적으로 버킷 내에 있는 객체들을 url를 통해 접근하려고 하면 안된다.

그 이유는 생성 설정에 모든 퍼블릭 액세스 차단을 설정했기 때문

![스크린샷 2022-04-08 오후 3.14.24.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.14.24.png)

생성할 때 위 설정을 바꾸거나 이미 만들어진 S3는 버킷 내에 권한 설정으로 들어가 변경할 수 있다.

![스크린샷 2022-04-08 오후 3.15.17.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.15.17.png)

ACL ⇒ S3의 모든 객체가 ACL를 가지고 있으며 이를 이용해 개별 권한제어가 가능하다.

ACL 역시 초기 설정은 사용안하도록 설정이 되어있으므로 개별 버킷 설정에 들어가서 허용하도록 변경을 해준다.

![스크린샷 2022-04-08 오후 3.19.57.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.19.57.png)

이후 특정 객체에 들어가 객체 작업을 눌러 “ACL를 사용하여 퍼블릭으로 설정” 버튼을 눌러 변경하거나 “권한” 탭으로 들어가 세부적인 설정도 가능하다.

![스크린샷 2022-04-08 오후 3.20.34.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.20.34.png)

### Bucket Policy

⇒ 객체 단위가 아닌 버킷 정책을 설정

버킷 설정 / 버킷 정책 설정 - 편집 / 정책 생성기 버튼 클릭

![스크린샷 2022-04-08 오후 3.27.27.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.27.27.png)

Select Type of Policy 는 S3버킷 

principal은 * 

Actions는 GetObject ⇒ AWS API임

ARN은 버킷 정책 설정에 적혀져 있으며 추가적인 폴더 프리픽스를 추가할 수 있음 

Ex) arn:aws:s3:::nemne-inf2/public/*

add statement & generate policy & 복사 붙여넣기

⇒ public 폴더 안에 있는 모든 파일들은 별도의 ACL 설정 없이 퍼블릭으로 전환됨

### CLI로 S3 사용하기

```bash
// s3 리스트 조회
aws s3 ls

// s3 버킷 생성 -> 이 경우에는 자동으로 퍼블릭 설정이 된다.
aws s3 mb s3://버킷_이름

// 객체 업로드
aws s3 cp 올릴_파일 s3://버킷_이름

// 객체 다운로드
aws s3 cp s3://버킷_이름/파일명 로컬_위치

// 객체 삭제
aws s3 rm s3://버킷_이름/파일명

// 폴더를 통채로 올리기
aws s3 sync 폴더_경로 s3://버킷_이름

// 퍼블릭으로 권한 변경
aws s3api put-object-acl --bucket 버킷_이름 --key 버킷_객체명 --acl public-read

// 버킷 삭제(내부 파일이 없어야됨)
aws s3api delete-bucket --bucket 버킷_이름

// 버킷 내부 객체 전체 삭제
aws s3 rm s3://버킷_이름/파일명 --recursive
```

### static web hosting 사용하기

- 정적 웹 호스팅이란? s3 페이지를 웹 서버처럼 사용가능
- CDN 서비스인 cloudfront와 연동시 성능 및 보안에 이점이 있음 + Route53을 이용해서 DNS 연동 가능

버킷 정책을 통해 전체 퍼블릭을 바꾸고

버킷 설정에서 정적 웹 호스팅 설정하기

### Multipart upload

- 단일 PUT으로 5기가 까지 가능
- 그러나 멀티파트 업로드를 통해 5테라까지 가능

### 요금

- 객체 저장비용 / 네트워크 전송비용 / api 요청비용이 있음
- 비용 알람 설정 필수
- 스토리지 클래스와 라이프 사이클 쓰면 비용을 절감할 수 있다.

[Amazon S3 Simple Storage Service 요금 - Amazon Web Services](https://aws.amazon.com/ko/s3/pricing/?nc=sn&loc=4)

[객체 스토리지 클래스 - Amazon S3](https://aws.amazon.com/ko/s3/storage-classes/)

특정 객체 - 속성에서 스토리지 클래스를 지정할 수 있다.

![스크린샷 2022-04-08 오후 3.59.46.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.59.46.png)

### 라이프 사이클

→ 파일 생성후 라이프 사이클 규칙을 지정하고 수명 관리 기능

Ex) 로그 파일 수명 관리

![스크린샷 2022-04-08 오후 4.01.45.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.01.45.png)

버전관리

![스크린샷 2022-04-08 오후 4.02.42.png](S3%204cf92c6f6f41435e89a6abdd0aef1f09/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.02.42.png)